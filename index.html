<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billiard Pro - Fixed Saving System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }
        .font-digital { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="p-4 lg:p-8">

    <div class="max-w-6xl mx-auto space-y-6">
        <div class="flex justify-between items-center bg-slate-900 p-4 rounded-2xl border border-slate-800">
            <h1 class="text-xl font-black font-digital text-yellow-500">üé± BILLIARD PRO</h1>
            <button onclick="clearAll()" class="text-xs bg-red-900/30 text-red-500 border border-red-500/50 px-4 py-1 rounded-full">RESET SEMUA</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-3 space-y-4">
                <div class="glass p-5 rounded-2xl">
                    <h3 class="text-xs font-bold text-yellow-500 uppercase mb-4">Input Pemain</h3>
                    <input type="text" id="pName" placeholder="Nama..." class="w-full p-2 bg-slate-800 border border-slate-700 rounded mb-2 outline-none focus:border-yellow-500">
                    <select id="pGrade" class="w-full p-2 bg-slate-800 border border-slate-700 rounded mb-4 text-yellow-500">
                        <option>G4</option><option>G5</option><option>G6</option><option>G7</option>
                    </select>
                    <button onclick="addPlayer()" class="w-full bg-yellow-500 text-black font-bold py-2 rounded">TAMBAH</button>
                </div>
                
                <button onclick="randomizeMatch()" class="w-full bg-indigo-600 py-3 rounded-xl font-bold shadow-lg">üé≤ ACAK PERTANDINGAN</button>
                
                <div id="playerList" class="space-y-2 max-h-40 overflow-y-auto"></div>
            </div>

            <div class="lg:col-span-9 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass p-6 rounded-3xl border-t-4 border-yellow-500">
                        <p class="text-[10px] font-bold text-slate-500 mb-4">TABLE 01</p>
                        <div class="flex justify-between items-center text-center gap-2 mb-6">
                            <div class="flex-1">
                                <p id="m1_p1" class="text-xs font-bold text-blue-400 truncate uppercase">PLAYER 1</p>
                                <div id="s1_1" class="text-5xl font-digital my-2">0</div>
                                <button onclick="upScore('s1_1')" class="bg-blue-600/20 text-blue-400 px-4 py-1 rounded text-[10px] border border-blue-600">+ FRAME</button>
                            </div>
                            <div class="text-slate-700 font-black">VS</div>
                            <div class="flex-1">
                                <p id="m1_p2" class="text-xs font-bold text-red-400 truncate uppercase">PLAYER 2</p>
                                <div id="s1_2" class="text-5xl font-digital my-2">0</div>
                                <button onclick="upScore('s1_2')" class="bg-red-600/20 text-red-400 px-4 py-1 rounded text-[10px] border border-red-600">+ FRAME</button>
                            </div>
                        </div>
                        <button onclick="saveMatch(1)" class="w-full bg-emerald-600 py-2 rounded-xl font-bold text-xs">SIMPAN HASIL</button>
                    </div>

                    <div class="glass p-6 rounded-3xl border-t-4 border-yellow-500">
                        <p class="text-[10px] font-bold text-slate-500 mb-4">TABLE 02</p>
                        <div class="flex justify-between items-center text-center gap-2 mb-6">
                            <div class="flex-1">
                                <p id="m2_p1" class="text-xs font-bold text-blue-400 truncate uppercase">PLAYER 1</p>
                                <div id="s2_1" class="text-5xl font-digital my-2">0</div>
                                <button onclick="upScore('s2_1')" class="bg-blue-600/20 text-blue-400 px-4 py-1 rounded text-[10px] border border-blue-600">+ FRAME</button>
                            </div>
                            <div class="text-slate-700 font-black">VS</div>
                            <div class="flex-1">
                                <p id="m2_p2" class="text-xs font-bold text-red-400 truncate uppercase">PLAYER 2</p>
                                <div id="s2_2" class="text-5xl font-digital my-2">0</div>
                                <button onclick="upScore('s2_2')" class="bg-red-600/20 text-red-400 px-4 py-1 rounded text-[10px] border border-red-600">+ FRAME</button>
                            </div>
                        </div>
                        <button onclick="saveMatch(2)" class="w-full bg-emerald-600 py-2 rounded-xl font-bold text-xs">SIMPAN HASIL</button>
                    </div>
                </div>

                <div class="glass rounded-2xl overflow-hidden">
                    <div class="p-4 bg-white/5 font-bold text-yellow-500 text-sm">üèÜ KLASEMEN RANGKING</div>
                    <table class="w-full text-left text-xs">
                        <thead class="bg-slate-900">
                            <tr><th class="p-3">POS</th><th class="p-3">NAMA</th><th class="p-3 text-center">W</th><th class="p-3 text-center">L</th><th class="p-3 text-center text-yellow-500">PTS</th></tr>
                        </thead>
                        <tbody id="rankTable"></tbody>
                    </table>
                </div>

                <div class="glass rounded-2xl overflow-hidden">
                    <div class="p-4 bg-white/5 font-bold text-blue-400 text-sm">üìú RIWAYAT PERTANDINGAN</div>
                    <div id="historyList" class="p-2 space-y-1 max-h-40 overflow-y-auto text-[10px]"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let db_players = JSON.parse(localStorage.getItem('billiard_p')) || [];
        let db_history = JSON.parse(localStorage.getItem('billiard_h')) || [];

        function saveDB() {
            localStorage.setItem('billiard_p', JSON.stringify(db_players));
            localStorage.setItem('billiard_h', JSON.stringify(db_history));
            renderAll();
        }

        function addPlayer() {
            const name = document.getElementById('pName').value.trim().toUpperCase();
            const grade = document.getElementById('pGrade').value;
            if(!name) return;
            if(db_players.find(p => p.name === name)) return alert("Nama sudah ada!");
            
            db_players.push({ name, grade, w: 0, l: 0, pts: 0 });
            document.getElementById('pName').value = "";
            saveDB();
        }

        function upScore(id) {
            const el = document.getElementById(id);
            el.innerText = parseInt(el.innerText) + 1;
        }

        function randomizeMatch() {
            if(db_players.length < 2) return alert("Pemain minimal 2!");
            
            // Cari pasangan yang belum pernah tanding
            let pairs = [];
            for(let i=0; i<db_players.length; i++) {
                for(let j=i+1; j<db_players.length; j++) {
                    const p1 = db_players[i].name;
                    const p2 = db_players[j].name;
                    const played = db_history.some(h => (h.p1===p1 && h.p2===p2) || (h.p1===p2 && h.p2===p1));
                    if(!played) pairs.push([db_players[i], db_players[j]]);
                }
            }

            if(pairs.length === 0) return alert("Semua pasangan sudah pernah bertanding!");
            pairs.sort(() => Math.random() - 0.5);

            // Set Meja 1
            document.getElementById('m1_p1').innerText = pairs[0][0].name;
            document.getElementById('m1_p2').innerText = pairs[0][1].name;
            
            // Set Meja 2 (jika ada pasangan lain)
            if(pairs.length > 1) {
                const p1_names = [pairs[0][0].name, pairs[0][1].name];
                const pair2 = pairs.find(p => !p1_names.includes(p[0].name) && !p1_names.includes(p[1].name));
                if(pair2) {
                    document.getElementById('m2_p1').innerText = pair2[0].name;
                    document.getElementById('m2_p2').innerText = pair2[1].name;
                }
            }
        }

        function saveMatch(table) {
            const p1Name = document.getElementById(`m${table}_p1`).innerText;
            const p2Name = document.getElementById(`m${table}_p2`).innerText;
            const s1 = parseInt(document.getElementById(`s${table}_1`).innerText);
            const s2 = parseInt(document.getElementById(`s${table}_2`).innerText);

            if(p1Name === "PLAYER 1") return alert("Meja kosong!");
            if(s1 === s2) return alert("Skor tidak boleh seri!");

            let p1 = db_players.find(p => p.name === p1Name);
            let p2 = db_players.find(p => p.name === p2Name);

            // UPDATE DATA
            if(s1 > s2) {
                p1.w += 1; p1.pts += 3; p2.l += 1;
            } else {
                p2.w += 1; p2.pts += 3; p1.l += 1;
            }

            // SIMPAN RIWAYAT
            db_history.unshift({ p1: p1Name, p2: p2Name, s1, s2, time: new Date().toLocaleTimeString() });

            // RESET MEJA
            document.getElementById(`m${table}_p1`).innerText = "PLAYER 1";
            document.getElementById(`m${table}_p2`).innerText = "PLAYER 2";
            document.getElementById(`s${table}_1`).innerText = "0";
            document.getElementById(`s${table}_2`).innerText = "0";

            saveDB();
            alert("Hasil Pertandingan Disimpan!");
        }

        function renderAll() {
            // Render List Pemain
            document.getElementById('playerList').innerHTML = db_players.map(p => `
                <div class="bg-slate-800 p-2 rounded border border-slate-700 text-[10px] flex justify-between">
                    <span>${p.name} (${p.grade})</span>
                    <span class="text-yellow-500 font-bold">${p.pts} PTS</span>
                </div>
            `).join('');

            // Render Ranking
            const sorted = [...db_players].sort((a,b) => b.pts - a.pts || b.w - a.w);
            document.getElementById('rankTable').innerHTML = sorted.map((p,i) => `
                <tr class="border-b border-white/5 hover:bg-white/5">
                    <td class="p-3 text-yellow-600 font-bold">${i+1}</td>
                    <td class="p-3 font-bold">${p.name} <span class="text-slate-500 text-[10px]">(${p.grade})</span></td>
                    <td class="p-3 text-center text-emerald-400">${p.w}</td>
                    <td class="p-3 text-center text-red-400">${p.l}</td>
                    <td class="p-3 text-center font-black text-yellow-500">${p.pts}</td>
                </tr>
            `).join('');

            // Render Riwayat
            document.getElementById('historyList').innerHTML = db_history.map(h => `
                <div class="bg-slate-900 p-2 rounded border-l-2 border-emerald-500 flex justify-between">
                    <span><b>${h.p1}</b> ${h.s1} - ${h.s2} <b>${h.p2}</b></span>
                    <span class="text-slate-600">${h.time}</span>
                </div>
            `).join('');
        }

        function clearAll() {
            if(confirm("Hapus semua data permanen?")) {
                localStorage.clear();
                location.reload();
            }
        }

        renderAll();
    </script>
</body>
</html>
