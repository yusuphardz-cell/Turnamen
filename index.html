<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billiard Pro League System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        .font-digital { font-family: 'Orbitron', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen pb-20">

    <nav class="bg-black border-b-2 border-yellow-600 p-4 sticky top-0 z-50 shadow-2xl">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black text-yellow-500 tracking-tighter font-digital">ðŸŽ± BILLIARD<span class="text-white">PRO</span></h1>
            <div class="flex space-x-2">
                <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-500 px-3 py-1 rounded text-xs font-bold transition">EKSPOR EXCEL</button>
                <button onclick="clearDatabase()" class="bg-red-700 hover:bg-red-600 px-3 py-1 rounded text-xs font-bold transition">RESET DATA</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 lg:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="space-y-6">
                <section class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
                    <h3 class="text-lg font-bold mb-4 text-yellow-500">Pendaftaran Pemain</h3>
                    <div class="space-y-3">
                        <input type="text" id="playerName" placeholder="Nama Pemain" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 outline-none">
                        <select id="playerGrade" class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg">
                            <option value="G4">Grade 4</option>
                            <option value="G5">Grade 5</option>
                            <option value="G6">Grade 6</option>
                            <option value="G7">Grade 7</option>
                        </select>
                        <button onclick="registerPlayer()" class="w-full bg-yellow-600 hover:bg-yellow-500 py-3 rounded-lg font-bold transition">Tambahkan Pemain</button>
                    </div>
                </section>

                <section class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
                    <h3 class="text-lg font-bold mb-4">Daftar Pemain (<span id="playerCount">0</span>)</h3>
                    <div id="playerList" class="space-y-2 max-h-60 overflow-y-auto pr-2">
                        </div>
                </section>
            </div>

            <div class="lg:col-span-2 space-y-6">
                
                <div class="flex justify-center">
                    <div id="timerContainer" class="bg-slate-800 border-8 border-slate-700 rounded-full w-44 h-44 flex flex-col items-center justify-center shadow-2xl transition-all duration-300">
                        <span class="text-[10px] font-bold text-slate-400">SHOT CLOCK</span>
                        <div id="timerDisplay" class="text-6xl font-digital font-black text-white">30</div>
                        <div class="flex space-x-2 mt-2">
                            <button onclick="startTimer()" class="bg-blue-600 hover:bg-blue-500 px-3 py-1 rounded-full text-[10px] font-bold">START</button>
                            <button onclick="extension()" class="bg-purple-600 hover:bg-purple-500 px-3 py-1 rounded-full text-[10px] font-bold">EXTEND</button>
                            <button onclick="resetTimer()" class="bg-slate-600 hover:bg-slate-500 px-3 py-1 rounded-full text-[10px] font-bold">RESET</button>
                        </div>
                    </div>
                </div>

                <section class="bg-slate-800 p-8 rounded-3xl border border-slate-700 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-yellow-600"></div>
                    <div class="flex justify-between items-center text-center">
                        <div class="flex-1">
                            <h2 id="p1DisplayName" class="text-xl font-bold mb-2 text-blue-400 font-digital uppercase">PLAYER 1</h2>
                            <div id="score1" class="text-8xl font-black text-white mb-6">0</div>
                            <button onclick="updateScore('score1', 1)" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black text-xl shadow-lg">+ FRAME</button>
                        </div>
                        <div class="px-6 text-2xl font-black text-slate-600 italic uppercase">vs</div>
                        <div class="flex-1">
                            <h2 id="p2DisplayName" class="text-xl font-bold mb-2 text-red-400 font-digital uppercase">PLAYER 2</h2>
                            <div id="score2" class="text-8xl font-black text-white mb-6">0</div>
                            <button onclick="updateScore('score2', 1)" class="w-full bg-red-600 hover:bg-red-500 py-4 rounded-xl font-black text-xl shadow-lg">+ FRAME</button>
                        </div>
                    </div>
                    <button onclick="finishMatch()" class="mt-8 w-full bg-green-700 hover:bg-green-600 py-4 rounded-xl font-bold tracking-widest text-lg transition-transform hover:scale-[1.02]">
                        SELESAIKAN & SIMPAN HASIL
                    </button>
                </section>

                <section class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl overflow-hidden">
                    <h3 class="text-lg font-bold mb-4 text-yellow-500 flex items-center">
                        <span class="w-2 h-6 bg-yellow-500 mr-2 rounded"></span> KLASEMEN LIGA
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-900 text-slate-400 text-xs uppercase">
                                <tr>
                                    <th class="p-3">Pos</th>
                                    <th class="p-3">Pemain</th>
                                    <th class="p-3 text-center">Main</th>
                                    <th class="p-3 text-center">M</th>
                                    <th class="p-3 text-center">K</th>
                                    <th class="p-3 text-center">+/-</th>
                                    <th class="p-3 text-center bg-yellow-900/20 text-yellow-500">Poin</th>
                                </tr>
                            </thead>
                            <tbody id="leagueTableBody" class="text-sm divide-y divide-slate-700">
                                </tbody>
                        </table>
                    </div>
                </section>

                <section class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
                    <h3 class="text-lg font-bold mb-4 text-slate-400 italic">LOG RIWAYAT PERTANDINGAN</h3>
                    <div id="matchHistory" class="space-y-3 max-h-60 overflow-y-auto pr-2 text-sm text-slate-500">
                        Belum ada data pertandingan.
                    </div>
                </section>

            </div>
        </div>
    </div>

    <script>
        // DATA STATE
        let players = [];
        let matchLogs = [];
        let timeLeft = 30;
        let timerId = null;

        // LOAD DATA AWAL
        window.onload = function() {
            const savedPlayers = localStorage.getItem('bill_players');
            const savedLogs = localStorage.getItem('bill_logs');
            if (savedPlayers) players = JSON.parse(savedPlayers);
            if (savedLogs) matchLogs = JSON.parse(savedLogs);
            
            updatePlayerList();
            updateLeagueTable();
            updateMatchHistoryUI();
        };

        function saveAll() {
            localStorage.setItem('bill_players', JSON.stringify(players));
            localStorage.setItem('bill_logs', JSON.stringify(matchLogs));
        }

        // FUNGSI PEMAIN
        function registerPlayer() {
            const name = document.getElementById('playerName');
            const grade = document.getElementById('playerGrade');
            if (!name.value) return alert("Isi nama pemain!");

            players.push({
                id: Date.now(),
                name: name.value,
                grade: grade.value,
                played: 0, wins: 0, losses: 0, margin: 0, points: 0
            });

            name.value = "";
            updatePlayerList();
            updateLeagueTable();
            saveAll();
        }

        function updatePlayerList() {
            const list = document.getElementById('playerList');
            document.getElementById('playerCount').innerText = players.length;
            list.innerHTML = players.map(p => `
                <div class="flex justify-between items-center bg-slate-900 p-3 rounded-lg border border-slate-700">
                    <span class="font-bold">${p.name} <small class="text-blue-500">${p.grade}</small></span>
                    <div class="flex space-x-1">
                        <button onclick="setPlayer('${p.name}', '${p.grade}', 1)" class="bg-blue-600 text-[10px] px-2 py-1 rounded font-bold">P1</button>
                        <button onclick="setPlayer('${p.name}', '${p.grade}', 2)" class="bg-red-600 text-[10px] px-2 py-1 rounded font-bold">P2</button>
                    </div>
                </div>
            `).join('') || '<p class="text-slate-500 italic">Belum ada pemain.</p>';
        }

        function setPlayer(name, grade, slot) {
            document.getElementById(`p${slot}DisplayName`).innerText = `${name} (${grade})`;
        }

        // FUNGSI MATCH & SCORE
        function updateScore(id, val) {
            const el = document.getElementById(id);
            el.innerText = parseInt(el.innerText) + val;
            resetTimer();
        }

        function finishMatch() {
            const s1 = parseInt(document.getElementById('score1').innerText);
            const s2 = parseInt(document.getElementById('score2').innerText);
            const n1Raw = document.getElementById('p1DisplayName').innerText;
            const n2Raw = document.getElementById('p2DisplayName').innerText;

            if (n1Raw === "PLAYER 1" || n2Raw === "PLAYER 2") return alert("Pilih pemain dulu!");
            if (s1 === 0 && s2 === 0) return alert("Skor masih kosong!");

            const name1 = n1Raw.split(' (')[0];
            const name2 = n2Raw.split(' (')[0];

            // Update Stats Pemain
            let p1 = players.find(p => p.name === name1);
            let p2 = players.find(p => p.name === name2);

            p1.played++; p2.played++;
            p1.margin += (s1 - s2);
            p2.margin += (s2 - s1);

            if (s1 > s2) { p1.wins++; p1.points += 3; p2.losses++; }
            else if (s2 > s1) { p2.wins++; p2.points += 3; p1.losses++; }

            // Tambah Log
            matchLogs.unshift({
                time: new Date().toLocaleTimeString(),
                p1: name1, p2: name2, s1, s2
            });

            // Reset UI Papan Skor
            document.getElementById('score1').innerText = 0;
            document.getElementById('score2').innerText = 0;

            updateLeagueTable();
            updateMatchHistoryUI();
            saveAll();
            alert("Pertandingan Selesai!");
        }

        function updateLeagueTable() {
            const sorted = [...players].sort((a,b) => b.points - a.points || b.margin - a.margin);
            document.getElementById('leagueTableBody').innerHTML = sorted.map((p, i) => `
                <tr class="hover:bg-slate-700/30">
                    <td class="p-3 font-digital text-yellow-600">${i+1}</td>
                    <td class="p-3 font-bold">${p.name} <small class="text-slate-500">${p.grade}</small></td>
                    <td class="p-3 text-center">${p.played}</td>
                    <td class="p-3 text-center text-green-400">${p.wins}</td>
                    <td class="p-3 text-center text-red-400">${p.losses}</td>
                    <td class="p-3 text-center">${p.margin > 0 ? '+' : ''}${p.margin}</td>
                    <td class="p-3 text-center font-black bg-yellow-900/10 text-yellow-500">${p.points}</td>
                </tr>
            `).join('');
        }

        function updateMatchHistoryUI() {
            document.getElementById('matchHistory').innerHTML = matchLogs.map(l => `
                <div class="bg-slate-900 p-3 rounded-lg border border-slate-700 flex justify-between">
                    <span>${l.p1} <strong>${l.s1}-${l.s2}</strong> ${l.p2}</span>
                    <span class="text-[10px] uppercase text-slate-600">${l.time}</span>
                </div>
            `).join('') || 'Belum ada data.';
        }

        // SHOT CLOCK LOGIC
        function startTimer() {
            clearInterval(timerId);
            timeLeft = 30;
            updateTimerUI();
            timerId = setInterval(() => {
                timeLeft--; updateTimerUI();
                if (timeLeft <= 0) { clearInterval(timerId); alert("TIME OUT / FOUL!"); }
            }, 1000);
        }
        function resetTimer() { clearInterval(timerId); timeLeft = 30; updateTimerUI(); }
        function extension() { timeLeft += 30; updateTimerUI(); }
        function updateTimerUI() {
            const d = document.getElementById('timerDisplay');
            const c = document.getElementById('timerContainer');
            d.innerText = timeLeft;
            c.style.borderColor = timeLeft > 15 ? "#16a34a" : timeLeft > 5 ? "#ca8a04" : "#dc2626";
        }

        // EKSPOR & RESET
        function exportToExcel() {
            let csv = "Nama,Grade,Main,Menang,Kalah,Margin,Poin\n";
            players.forEach(p => csv += `${p.name},${p.grade},${p.played},${p.wins},${p.losses},${p.margin},${p.points}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'Klasemen_Liga_Billiard.csv';
            a.click();
        }

        function clearDatabase() {
            if (confirm("Hapus semua data pemain dan klasemen?")) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
